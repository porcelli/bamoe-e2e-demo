<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Loan Application Form</title>
        <!-- Bootstrap CSS CDN -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
    </head>
    <body>
        <div class="container mt-5">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card shadow">
                        <div class="card-body">
                            <h1 class="card-title text-center">
                                Welcome to ACME Loan
                            </h1>
                            <p class="text-center text-muted mb-4">
                                Please fill out the form below to apply for a
                                loan. Our team will review your application and
                                get back to you as soon as possible.
                            </p>
                            <form id="loanForm">
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <label for="fullName" class="form-label"
                                            >Full Name:</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="fullName"
                                            name="fullName"
                                            required=""
                                        />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="dob" class="form-label"
                                            >Date of Birth:</label
                                        >
                                        <input
                                            type="date"
                                            class="form-control"
                                            id="dob"
                                            name="dob"
                                            required=""
                                        />
                                    </div>
                                    <div class="col-md-6">
                                        <label for="ssn" class="form-label"
                                            >Last 4 Digits of SSN:</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="ssn"
                                            name="ssn"
                                            maxlength="4"
                                            pattern="\d{4}"
                                            required=""
                                        />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <label for="income" class="form-label"
                                            >Annual Income:</label
                                        >
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="income"
                                            name="income"
                                            min="0"
                                            required=""
                                        />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <label for="address1" class="form-label"
                                            >Address 1:</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="address1"
                                            name="address1"
                                            required=""
                                        />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <label for="address2" class="form-label"
                                            >Address 2:</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="address2"
                                            name="address2"
                                        />
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="city" class="form-label"
                                            >City:</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="city"
                                            name="city"
                                        />
                                    </div>
                                    <div class="col-md-4">
                                        <label for="state" class="form-label"
                                            >State:</label
                                        >
                                        <select
                                            class="form-select"
                                            id="state"
                                            name="state"
                                            required=""
                                        >
                                            <option value="">
                                                Select State
                                            </option>
                                            <option value="AL">AL</option>
                                            <option value="AK">AK</option>
                                            <option value="AZ">AZ</option>
                                            <option value="AR">AR</option>
                                            <option value="CA">CA</option>
                                            <option value="CO">CO</option>
                                            <option value="CT">CT</option>
                                            <option value="DE">DE</option>
                                            <option value="FL">FL</option>
                                            <option value="GA">GA</option>
                                            <option value="HI">HI</option>
                                            <option value="ID">ID</option>
                                            <option value="IL">IL</option>
                                            <option value="IN">IN</option>
                                            <option value="IA">IA</option>
                                            <option value="KS">KS</option>
                                            <option value="KY">KY</option>
                                            <option value="LA">LA</option>
                                            <option value="ME">ME</option>
                                            <option value="MD">MD</option>
                                            <option value="MA">MA</option>
                                            <option value="MI">MI</option>
                                            <option value="MN">MN</option>
                                            <option value="MS">MS</option>
                                            <option value="MO">MO</option>
                                            <option value="MT">MT</option>
                                            <option value="NE">NE</option>
                                            <option value="NV">NV</option>
                                            <option value="NH">NH</option>
                                            <option value="NJ">NJ</option>
                                            <option value="NM">NM</option>
                                            <option value="NY">NY</option>
                                            <option value="NC">NC</option>
                                            <option value="ND">ND</option>
                                            <option value="OH">OH</option>
                                            <option value="OK">OK</option>
                                            <option value="OR">OR</option>
                                            <option value="PA">PA</option>
                                            <option value="RI">RI</option>
                                            <option value="SC">SC</option>
                                            <option value="SD">SD</option>
                                            <option value="TN">TN</option>
                                            <option value="TX">TX</option>
                                            <option value="UT">UT</option>
                                            <option value="VT">VT</option>
                                            <option value="VA">VA</option>
                                            <option value="WA">WA</option>
                                            <option value="WV">WV</option>
                                            <option value="WI">WI</option>
                                            <option value="WY">WY</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="zip" class="form-label"
                                            >Zip Code:</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="zip"
                                            name="zip"
                                            maxlength="5"
                                            pattern="\d{5}"
                                            required=""
                                        />
                                    </div>
                                </div>
                                <button
                                    type="submit"
                                    class="btn btn-primary w-100"
                                >
                                    Submit Application
                                </button>
                            </form>
                            <div
                                id="responseMessage"
                                class="mt-3 text-center"
                                style="color: rgb(40, 167, 69)"
                            >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS and dependencies -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            document
                .getElementById("loanForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();

                    // Validate Date of Birth for 18+ years old
                    const dob = new Date(document.getElementById("dob").value);
                    const today = new Date();
                    const age = today.getFullYear() - dob.getFullYear();
                    const m = today.getMonth() - dob.getMonth();
                    if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                        age--;
                    }

                    if (age < 18) {
                        document.getElementById("responseMessage").innerText =
                            "You must be at least 18 years old to apply.";
                        return;
                    }

                    // Get form data
                    const formData = {
                        fullName: document.getElementById("fullName").value,
                        dob: document.getElementById("dob").value,
                        ssn: document.getElementById("ssn").value,
                        income: document.getElementById("income").value,
                        address1: document.getElementById("address1").value,
                        address2: document.getElementById("address2").value,
                        city: document.getElementById("city").value,
                        state: document.getElementById("state").value,
                        zip: document.getElementById("zip").value,
                    };

                    // Send data to REST endpoint
                    fetch("/LoanApplication", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(formData),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            document.getElementById(
                                "responseMessage",
                            ).style.color = "#28a745";
                            document.getElementById(
                                "responseMessage",
                            ).innerText = "Application submitted successfully!";
                        })
                        .catch((error) => {
                            console.log(error);
                            document.getElementById(
                                "responseMessage",
                            ).innerText = "Error submitting application.";
                        });
                });
        </script>
    </body>
</html>
